import{d as w}from"./Layout-B1bU_74f.js";import{r as n,A as q,S as z,x as K,u as P,k as I}from"./index-BmZ_dwCv.js";import{u as Q}from"./index.esm-DazwP4qc.js";import{A as b}from"./AdminServices-LtusNjKA.js";import{n as M,b as U}from"./button-4tHrV-ob.js";import{u as W}from"./useTranslationValue-BbCbvZPg.js";import{u as X}from"./useDisableForDemo-CWmzrrYY.js";const ie=o=>{const{state:_,dispatch:k}=n.useContext(q),{adminInfo:c}=_,{setIsUpdate:y,lang:C}=n.useContext(z),{openDrawer:L,closeDrawer:D}=K(),[Y,f]=n.useState(""),[h,x]=n.useState(w(new Date).format("YYYY-MM-DD")),[i,j]=n.useState("en"),[s,A]=n.useState({}),[v,p]=n.useState(!1),[g,E]=n.useState([]),O=P(),{handlerTextTranslateHandler:F}=W(),{handleDisableForDemo:N}=X(),{control:R,register:V,handleSubmit:B,setValue:t,clearErrors:m,formState:{errors:G}}=Q(),H=async a=>{var l,u;try{if(N()&&(s==null?void 0:s.email)==="admin@gmail.com")return;p(!0);const S={name:{...await F(a.name,i,s==null?void 0:s.name),[i]:a.name},email:a.email,password:a.password,phone:a.phone,role:a.role,access_list:g==null?void 0:g.map(r=>r.value),joiningDate:h||w(new Date).format("YYYY-MM-DD"),image:Y,lang:i},d=(c==null?void 0:c._id)===(s==null?void 0:s._id);if(o){const r=await b.updateStaff(o,S);d&&(k({type:"USER_LOGIN",payload:r}),I.set("adminInfo",JSON.stringify(r),{expires:.5,sameSite:"None",secure:!0})),y(!0),p(!1),U("Staff Updated Successfully!"),D()}else{const r=await b.addStaff(S);y(!0),p(!1),U(r.message),D()}}catch(e){M(e?(u=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:u.message:e==null?void 0:e.message),p(!1),D()}},T=async()=>{var a,l,u;try{const e=await b.getStaffById(o,{email:c.email});if(e){A(e),t("name",e.name[i||"en"]),t("email",e.email),t("password"),t("phone",e.phone),t("role",e.role),x(w(e.joiningData).format("YYYY-MM-DD")),f(e.image);const S=(a=e==null?void 0:e.access_list)==null?void 0:a.map(d=>({label:d,value:d}));E(S)}}catch(e){M(e?(u=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:u.message:e==null?void 0:e.message)}},J=a=>{j(a),Object.keys(s).length>0&&t("name",s.name[a||"en"])};return n.useEffect(()=>{if(!o){A({}),t("name"),t("email"),t("password"),t("phone"),t("role"),t("joiningDate"),f(""),m("name"),m("email"),m("password"),m("phone"),m("role"),m("joiningDate"),f(""),j(C),t("language",i);return}},[t,o,L,c.email,m]),n.useEffect(()=>{o&&T()},[o]),n.useEffect(()=>{O.pathname==="/edit-profile"&&I.get("adminInfo")&&T()},[O.pathname,t]),{control:R,register:V,handleSubmit:B,onSubmit:H,language:i,errors:G,adminInfo:c,setImageUrl:f,imageUrl:Y,selectedDate:h,setSelectedDate:x,isSubmitting:v,accessedRoutes:g,setAccessedRoutes:E,handleSelectLanguage:J}};export{ie as u};
