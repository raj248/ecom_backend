import{r as p,S as se,x as $,y as ae,l as te,j as e,m as ne}from"./index-lrQuldHs.js";import{I as re}from"./input-DxgA4gbo.js";import{T as ie}from"./ParentCategory-DqAAqud_.js";import{u as G,S as le,A as Q,i as M,j as z,I as de}from"./Layout-zjBccTHe.js";import{n as H,b as K}from"./button-rh3FTULs.js";import{u as oe,E as W}from"./index.esm-BUE4Z1sU.js";import{T as Y,D as me,u as ce}from"./DrawerButton-CHM5Wu-i.js";import{I as pe}from"./InputArea-C6cF93jC.js";import{L as D}from"./LabelArea-CL5vBgQk.js";import{S as he}from"./SwitchToggle-BZHbvCGz.js";import{T as ue,C as xe,S as ge}from"./ShowHideButton-B5Ky8xjG.js";import{U as fe}from"./Uploader-XL13W98r.js";import{b as L}from"./ProductServices-DkrntO0G.js";import{u as je}from"./useTranslationValue-2zmYr2dJ.js";import{e as be,c as Ce,f as v}from"./table-pH1NcXB9.js";import{E as Se}from"./EditDeleteButton-BFQAVewg.js";const Ne=(r,h)=>{const{setIsUpdate:i,lang:j}=p.useContext(se),{openDrawer:u,closeDrawer:m}=$(),[l,s]=p.useState({}),[x,f]=p.useState(""),[b,T]=p.useState(""),[P,E]=p.useState([]),[d,I]=p.useState("en"),[A,_]=p.useState(!0),[C,k]=p.useState(""),[B,S]=p.useState(!1),{handlerTextTranslateHandler:w}=je(),U=ae(),{control:a,register:c,handleSubmit:o,setValue:n,clearErrors:N,reset:J,formState:{errors:X}}=oe(),Z=async({name:t,description:F})=>{var R,V;try{S(!0);const g=await w(t,d,l==null?void 0:l.name),ee=await w(F,d,l==null?void 0:l.description),q={name:{...g,[d]:t},description:{...ee,[d]:F||""},parentId:x||void 0,parentName:C||"Home",icon:b,status:A?"show":"hide",lang:d};if(r){const O=await L.updateCategory(r,q);i(!0),S(!1),K(O.message),m(),J(),U.invalidateQueries(["categories"])}else{const O=await L.addCategory(q);i(!0),S(!1),K(O.message),m(),U.invalidateQueries(["categories"])}}catch(g){S(!1),H(g?(V=(R=g==null?void 0:g.response)==null?void 0:R.data)==null?void 0:V.message:g==null?void 0:g.message),m()}},y=t=>{I(t),Object.keys(l).length>0&&(n("name",l.name[t||"en"]),n("description",l.description[t||"en"]))};return p.useEffect(()=>{var t;if(!r){s({}),n("name"),n("parentId"),n("parentName"),n("description"),n("icon"),T(""),_(!0),N("name"),N("parentId"),N("parentName"),N("description"),k("Home"),I(j),n("language",d),h!==void 0&&((t=h[0])==null?void 0:t._id)!==void 0&&f(h[0]._id);return}},[n,r,u,N,j]),p.useEffect(()=>{r&&(async()=>{try{const t=await L.getCategoryById(r);t&&(s(t),n("name",t.name[d||"en"]),n("description",t.description[d||"en"]),n("language",d),n("parentId",t.parentId),n("parentName",t.parentName),k(t.parentName),f(t.parentId),T(t.icon),_(t.status==="show"))}catch(t){H(t?t.response.data.message:t.message)}})()},[r]),{control:a,register:c,language:d,handleSubmit:o,onSubmit:Z,errors:X,imageUrl:b,setImageUrl:T,children:P,setChildren:E,published:A,setPublished:_,checked:x,setChecked:f,isSubmitting:B,selectCategoryName:C,setSelectCategoryName:k,handleSelectLanguage:y}},Re=({id:r,data:h})=>{const{t:i}=te(),{language:j,checked:u,register:m,onSubmit:l,handleSubmit:s,errors:x,imageUrl:f,setImageUrl:b,published:T,setPublished:P,setChecked:E,selectCategoryName:d,setSelectCategoryName:I,handleSelectLanguage:A,isSubmitting:_}=Ne(r,h),{showingTranslateValue:C}=G(),k=`
  .rc-tree-child-tree {
    display: hidden;
  }
  .node-motion {
    transition: all .3s;
    overflow-y: hidden;
  }
`,B={motionName:"node-motion",motionAppear:!1,onAppearStart:a=>({height:0}),onAppearActive:a=>({height:a.scrollHeight}),onLeaveStart:a=>({height:a.offsetHeight}),onLeaveActive:()=>({height:0})},S=a=>{let c=[];for(let o of a)c.push({title:C(o.name),key:o._id,children:o.children.length>0&&S(o.children)});return c},w=(a,c)=>{var o;return a._id===c?a:(o=a==null?void 0:a.children)==null?void 0:o.reduce((n,N)=>n??w(N,c),void 0)},U=async a=>{if(a!==void 0)if(r){const c=await L.getCategoryById(a);if(r===a)return H("This can't be select as a parent category!");if(r===c.parentId)return H("This can't be select as a parent category!");{if(a===void 0)return;E(a);const o=h[0],n=w(o,a);I(C(n==null?void 0:n.name))}}else{if(a===void 0)return;E(a);const c=h[0],o=w(c,a);I(C(o==null?void 0:o.name))}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:r?e.jsx(Y,{register:m,language:j,handleSelectLanguage:A,title:i("UpdateCategory"),description:i("UpdateCategoryDescription")}):e.jsx(Y,{register:m,language:j,handleSelectLanguage:A,title:i("AddCategoryTitle"),description:i("AddCategoryDescription")})}),e.jsx(le,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:s(l),children:[e.jsxs("div",{className:"p-6 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:i("Name")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(pe,{required:!0,register:m,label:"Category title",name:"name",type:"text",placeholder:i("ParentCategoryPlaceholder")}),e.jsx(W,{errorName:x.name})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:i("Description")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(ue,{register:m,label:"Description",name:"description",type:"text",placeholder:"Category Description"}),e.jsx(W,{errorName:x.description})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:i("ParentCategory")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4 relative",children:[e.jsx(re,{readOnly:!0,...m("parent",{required:!1}),name:"parent",value:d||"Home",placeholder:i("ParentCategory"),type:"text"}),e.jsxs("div",{className:"draggable-demo capitalize",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:k}}),e.jsx(ie,{expandAction:"click",treeData:S(h),selectedKeys:[u],onSelect:a=>U(a[0]),motion:B,animation:"slide-up"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:i("CategoryIcon")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(fe,{imageUrl:f,setImageUrl:b,folder:"category",targetWidth:238,targetHeight:238})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:i("Published")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(he,{handleProcess:P,processOption:T})})]})]}),e.jsx(me,{id:r,title:"Category",isSubmitting:_})]})})]})},Ve=({categories:r,showChild:h})=>{const{handleModalOpen:i,handleUpdate:j}=ce(),{showingTranslateValue:u}=G(),{handleSelect:m,selectedIds:l}=$();return e.jsx(e.Fragment,{children:e.jsx(be,{children:r==null?void 0:r.map(s=>{var x,f;return e.jsxs(Ce,{children:[e.jsx(v,{children:e.jsx(xe,{type:"checkbox",name:"category",id:s._id,handleSelect:m,isChecked:l==null?void 0:l.includes(s._id)})}),e.jsx(v,{className:"font-semibold uppercase text-xs",children:(x=s==null?void 0:s._id)==null?void 0:x.substring(20,24)}),e.jsx(v,{children:s!=null&&s.icon?e.jsxs(Q,{className:"hidden mr-3 md:block bg-gray-50 p-1",children:[e.jsx(M,{src:s==null?void 0:s.icon,alt:s==null?void 0:s.parent}),e.jsx(z,{children:"C"})]}):e.jsxs(Q,{className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none",children:[e.jsx(M,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product"}),e.jsx(z,{children:"C"})]})}),e.jsx(v,{className:"font-medium text-sm ",children:(s==null?void 0:s.children.length)>0?e.jsxs(ne,{to:`/categories/${s==null?void 0:s._id}`,className:"text-gray-700 dark:text-gray-300",children:[u(s==null?void 0:s.name),h&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"pl-2 ",children:(f=s==null?void 0:s.children)==null?void 0:f.map(b=>e.jsx("div",{children:e.jsxs("div",{className:"flex text-xs items-center  text-gray-700",children:[e.jsx("span",{className:" text-xs text-gray-500 pr-1",children:e.jsx(de,{})}),e.jsx("span",{className:"text-gray-500",children:u(b.name)})]})},b._id))})})]}):e.jsx("span",{children:u(s==null?void 0:s.name)})}),e.jsx(v,{className:"text-sm",children:u(s==null?void 0:s.description)}),e.jsx(v,{className:"text-center",children:e.jsx(ge,{id:s._id,category:!0,status:s.status})}),e.jsx(v,{children:e.jsx(Se,{id:s==null?void 0:s._id,parent:s,selectedIds:l,children:s==null?void 0:s.children,handleUpdate:j,handleModalOpen:i,title:u(s==null?void 0:s.name)})})]},s._id)})})})};export{Re as C,Ve as a};
