import{u as m}from"./Layout-zjBccTHe.js";import{H as w}from"./index-lrQuldHs.js";const T={translateText:async(a,i,f)=>(await w.get(`https://api.mymemory.translated.net/get?q=${a}&langpair=${i}|${f}`)).data},k=()=>{const{globalSetting:a,languages:i}=m(),f=r=>{if(!r)return r;const t={...r};return Object.keys(t).forEach(o=>{const e=t[o];(e!=null&&e.toLowerCase().includes("authentication failure")||e!=null&&e.toLowerCase().includes("error")||!e)&&(console.log(`Removing invalid translation for language: ${o}`),delete t[o])}),t},d=(r,t)=>{const o=i==null?void 0:i.map(e=>e==null?void 0:e.code);return r?!t||!(o!=null&&o.length)?!1:o==null?void 0:o.some(e=>r[e]?t[e]?r[e]!==t[e]:!1:!0):!0},h=async(r,t,o)=>{var y;const e=(a==null?void 0:a.translation_key)||"a91efbf362a6e399453d";try{const c=await T.translateText(r,t,o,e),s=(y=c==null?void 0:c.responseData)==null?void 0:y.translatedText;return s!=null&&s.toLowerCase().includes("authentication failure")||s!=null&&s.toLowerCase().includes("error")||!s?(console.error(`Translation API failed for ${t} to ${o}:`,s),null):s}catch(c){return console.error("error on translation",c),null}};return{hasKeyChanged:d,handleRemoveEmptyKey:r=>{for(const t in r)r[t].trim()===""&&delete r[t];return r},handlerTextTranslateHandler:async(r,t,o)=>{const e=f(o);if(!(a!=null&&a.allow_auto_trans)||!(d(e,{[t]:r})||!1))return!1;const c=i==null?void 0:i.filter(n=>(n==null?void 0:n.code)!==t),s=await Promise.all(c.map(n=>r?h(r==null?void 0:r.toLowerCase(),t,n==null?void 0:n.code):"")),p=c.map((n,u)=>{const l=s[u];return l&&!l.toLowerCase().includes("authentication failure")&&!l.toLowerCase().includes("error")?{lang:n==null?void 0:n.code,text:l}:null}).filter(Boolean).reduce((n,u)=>(n[u.lang]=u.text,n),{});return(e!=null&&e[t]||r)&&(p[t]=r),p}}};export{k as u};
